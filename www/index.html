<!DOCTYPE html>
<html ng-app="MovieApp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>Movie Times v2</title>

    <link href="lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false"></script>

    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

<script src="lib/ionic/js/jquery-2.1.4.js"></script>
    <!-- ionic/angularjs js -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>
    <script src="lib/imakewebthings-waypoints-13ae054/lib/jquery.waypoints.js" ></script>
    <script src="lib/imakewebthings-waypoints-13ae054/lib/shortcuts/inview.js"></script>
    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>

    <!-- your app's js -->
    <script src="js/verge.js"></script>
    <script src="js/app.js"></script>
    <script src="js/facGeoService.js"></script>
    <script src="js/facInterceptors.js"></script>
    <script src="js/facLocalStorage.js"></script>
    <script src="js/runFunctions.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.js"></script>
<script>


    (function ($) {
        function getViewportHeight() {
            var height = window.innerHeight; // Safari, Opera
            var mode = document.compatMode;

            if ( (mode || !$.support.boxModel) ) { // IE, Gecko
                height = (mode == 'CSS1Compat') ?
                        document.documentElement.clientHeight : // Standards
                        document.body.clientHeight; // Quirks
            }

            return height;
        }

        function getViewportWidth() {
            var width = window.innerWidth; // Safari, Opera
            var mode = document.compatMode;

            if ( (mode || !$.support.boxModel) ) { // IE, Gecko
                width = (mode == 'CSS1Compat') ?
                        document.documentElement.clientWidth : // Standards
                        document.body.clientWidth; // Quirks
            }

            return width;
        }

//        $(window).scroll(function () {
//            var vpH = getViewportHeight(),
//                    scrolltop = (document.documentElement.scrollTop ?
//                            document.documentElement.scrollTop :
//                            document.body.scrollTop),
//                    elems = [];
//
//            // naughty, but this is how it knows which elements to check for
//            $.each($.cache, function () {
//                if (this.events && this.events.inview) {
//                    elems.push(this.handle.elem);
//                }
//            });
//
//            if (elems.length) {
//                $(elems).each(function () {
//                    var $el = $(this),
//                            top = $el.offset().top,
//                            height = $el.height(),
//                            inview = $el.data('inview') || false;
//
//                    if (scrolltop > (top + height) || scrolltop + vpH < top) {
//                        if (inview) {
//                            $el.data('inview', false);
//                            $el.trigger('inview', [ false ]);
//                        }
//                    } else if (scrolltop < (top + height)) {
//                        if (!inview) {
//                            $el.data('inview', true);
//                            $el.trigger('inview', [ true ]);
//                        }
//                    }
//                });
//            }
//        });

        $(window).scroll(function () {
            var vpW = getViewportWidth(),
                    scrollleft = (document.documentElement.scrollLeft ?
                            document.documentElement.scrollLeft :
                            document.body.scrollLeft),
                    elems = [];

            // naughty, but this is how it knows which elements to check for
            $.each($.cache, function () {
                if (this.events && this.events.inview) {
                    elems.push(this.handle.elem);
                }
            });

            if (elems.length) {
                $(elems).each(function () {
                    var $el = $(this),
                            left = $el.offset().left,
                            width = $el.width(),
                            inview = $el.data('inview') || false;

                    if (scrollleft > (left + width) || scrollleft + vpH < left) {
                        if (inview) {
                            $el.data('inview', false);
                            $el.trigger('inview', [ false ]);
                        }
                    } else if (scrollleft < (left + width)) {
                        if (!inview) {
                            $el.data('inview', true);
                            $el.trigger('inview', [ true ]);
                        }
                    }
                });
            }
        });

        // kick the event to pick up any elements already in view.
        // note however, this only works if the plugin is included after the elements are bound to 'inview'
        $(function () {
            $(window).scroll();
        });
    })(jQuery);
</script>
</head>
<body ng-controller="MainCtrl">

<ion-nav-bar class="bar-energized" delegate-handle="root">
    <ion-nav-back-button>
    </ion-nav-back-button>
    <!--<ion-nav-buttons side="primary">-->
        <!--<button class="button button-icon icon ion-wifi" ng-click="defaultPrimaryButtonClick()"></button>-->
    <!--</ion-nav-buttons>-->
    <ion-nav-buttons side="secondary">
        <button class="button button-icon icon ion-information-circled" ng-click="defaultSecondaryButtonClick()"></button>
    </ion-nav-buttons>
</ion-nav-bar>

<ion-nav-view></ion-nav-view>
<script>

    var geoOptions = { enableHighAccuracy: false, timeout: 3000, maximumAge: 0 };
    window.navigator.geolocation.getCurrentPosition(geoOK, geoError, geoOptions);

    function geoError(err)
    {
        var acode = err.code;
        console.log("geolocate error " + acode);
    }

    function geoOK(pos)
    {
        console.log("geolocate ok " + pos);
    }

</script>
<!--<script src="http://192.168.1.113:8080/target/target-script-min.js#anonymous"></script>-->
</body>
</html>
